<div class="menu-layout">
  <aside class="menu-sidebar">
    <div class="menu-nav">
      <div class="nav-section">
        <h3 class="nav-title">
          <hero-icon name="bars-3" size="1rem"></hero-icon>
          Navegação Principal
        </h3>

        @for (item of menuItems(); track item.route) {
        <a class="nav-item" [class.hide-on-mobile]="item.route !== '/relatorio-base'"
          [routerLink]="requiresDirectNav(item.route) ? item.route : undefined" (click)="onMenuClick($event, item)"
          routerLinkActive="active">
          <hero-icon [name]="item.heroIcon" size="1.25rem"></hero-icon>
          <span>{{ item.label }}</span>
          <hero-icon name="chevron-right" size="1rem" class="nav-arrow"></hero-icon>
        </a>
        }
      </div>

      <div class="nav-divider hide-on-mobile"></div>

      <div class="nav-section hide-on-mobile">
        <h3 class="nav-title">
          <hero-icon name="cog-6-tooth" size="1rem"></hero-icon>
          Administração
        </h3>

        @for (item of adminItems(); track item.route) {
        <a class="nav-item admin" [routerLink]="item.route" routerLinkActive="active">
          <hero-icon [name]="item.heroIcon" size="1.25rem"></hero-icon>
          <span>{{ item.label }}</span>
          <hero-icon name="chevron-right" size="1rem" class="nav-arrow"></hero-icon>
        </a>
        }
      </div>
    </div>

    <div class="menu-footer hide-on-mobile">
      <div class="user-card">
        <div class="user-avatar">
          <hero-icon name="user-circle" size="2.5rem"></hero-icon>
        </div>
        <div class="user-info">
          <span class="user-name">{{ displayName || 'Usuário' }}</span>
          <span class="user-role">{{ displayPerfil || 'Perfil' }}</span>
        </div>
      </div>
      <button type="button" class="btn btn-logout" (click)="logout()">
        <hero-icon name="arrow-left-on-rectangle" size="1.25rem"></hero-icon>
        Sair do Sistema
      </button>
    </div>
  </aside>

  <main class="menu-content">
    <div class="logo-wrapper">
      <img src="assets/logo/BHTrans.png" alt="BHTrans logo" class="logo-img" />
    </div>
  </main>
</div>

<!-- Modal de Filtros para Relatórios -->
<div *ngIf="showReportFilterModal" class="modal-overlay" (click)="closeReportFilterModal()">
  <div class="modal-container" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <div class="modal-icon">
        <hero-icon name="funnel" size="1.5rem"></hero-icon>
      </div>
      <div>
        <h5 class="modal-title">Filtros do Relatório</h5>
        <p class="modal-subtitle">Selecione o período e filtros desejados</p>
      </div>
      <button type="button" class="modal-close" (click)="closeReportFilterModal()">
        <hero-icon name="x-mark" size="1.5rem"></hero-icon>
      </button>
    </div>
    <div class="modal-body">
      <div class="filter-group">
        <label class="filter-label">
          <hero-icon name="calendar" size="1rem"></hero-icon>
          Período
        </label>
        <div class="date-range">
          <input class="form-control" type="text" inputmode="numeric" placeholder="dd/mm/aaaa" maxlength="10"
            [(ngModel)]="reportFilter.dataInicio" (input)="onDateInput('dataInicio', $event)" appAutoFocus />
          <span class="date-separator">até</span>
          <input class="form-control" type="text" inputmode="numeric" placeholder="dd/mm/aaaa" maxlength="10"
            [(ngModel)]="reportFilter.dataFim" (input)="onDateInput('dataFim', $event)" />
        </div>
      </div>
      <div class="filter-row">
        <div class="filter-group">
          <label class="filter-label">Gerência</label>
          <select class="form-select" [(ngModel)]="reportFilter.gerencia">
            <option value="">Todos</option>
            <option *ngFor="let g of gerencias" [value]="g">{{ g }}</option>
          </select>
        </div>
        <div class="filter-group">
          <label class="filter-label">Turno</label>
          <select class="form-select" [(ngModel)]="reportFilter.turno">
            <option value="">Todos</option>
            <option *ngFor="let t of turnos" [value]="t">{{ t }}</option>
          </select>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button type="button" class="btn btn-outline-secondary" (click)="closeReportFilterModal()">Cancelar</button>
      <div class="filter-hint" *ngIf="!reportFiltersValid">
        <hero-icon name="exclamation-circle" size="1rem"></hero-icon>
        Selecione um período válido
      </div>
      <button type="button" class="btn btn-primary" (click)="confirmReportFilters()" [disabled]="!reportFiltersValid">
        <hero-icon name="check" size="1.25rem"></hero-icon>
        Continuar
      </button>
    </div>
  </div>
</div>

<!-- Modal de Filtros para Relatório Base -->
<div *ngIf="showFilterModal" class="modal-overlay" (click)="closeRelatorioBaseModal()">
  <div class="modal-container" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <div class="modal-icon">
        <hero-icon name="funnel" size="1.5rem"></hero-icon>
      </div>
      <div>
        <h5 class="modal-title">Selecionar Filtros</h5>
        <p class="modal-subtitle">Escolha a gerência e turno</p>
      </div>
      <button type="button" class="modal-close" (click)="closeRelatorioBaseModal()">
        <hero-icon name="x-mark" size="1.5rem"></hero-icon>
      </button>
    </div>
    <div class="modal-body">
      <div class="filter-row">
        <div class="filter-group">
          <label class="filter-label">Gerência</label>
          <select class="form-select" [(ngModel)]="selectedGerencia" appAutoFocus>
            <option *ngFor="let g of gerencias" [value]="g">{{ g }}</option>
          </select>
          <small class="form-text text-muted">Gerência para qual prestou o serviço</small>
        </div>
        <div class="filter-group">
          <label class="filter-label">Turno</label>
          <select class="form-select" [(ngModel)]="selectedTurno">
            <option *ngFor="let t of turnos" [value]="t">{{ t }}</option>
          </select>
        </div>
      </div>
      <div class="filter-row">
        <div class="filter-group">
          <label class="filter-label">Mat. 1</label>
          <input type="text" class="form-control" [(ngModel)]="selectedMat1" placeholder="Matrícula 1" inputmode="numeric" />
          <small class="form-text text-muted">Matrícula do agente digitador</small>
        </div>
        <div class="filter-group">
          <label class="filter-label">Mat. 2</label>
          <input type="text" class="form-control" [(ngModel)]="selectedMat2" placeholder="Matrícula 2 (opcional)" inputmode="numeric" />
          <small class="form-text text-muted">Matrícula do segundo agente</small>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button type="button" class="btn btn-outline-secondary" (click)="closeRelatorioBaseModal()">Cancelar</button>
      <div class="filter-hint" *ngIf="!selectedGerencia || !selectedTurno">
        <hero-icon name="exclamation-circle" size="1rem"></hero-icon>
        Selecione Gerência e Turno
      </div>
      <button type="button" class="btn btn-primary" (click)="confirmRelatorioBaseFilters()"
        [disabled]="!selectedGerencia || !selectedTurno">
        <hero-icon name="check" size="1.25rem"></hero-icon>
        Continuar
      </button>
    </div>
  </div>
</div>