<div class="page-container">
  <div class="page-header">
    <div class="page-title">
      <h1>Tabela de Produtividade</h1>
      <p class="page-subtitle">Gerencie os tipos de produtividade do sistema</p>
    </div>
    <div class="page-actions">
      <a class="btn btn-outline-secondary" [routerLink]="['/menu']">
        <hero-icon name="arrow-left" size="1.25rem"></hero-icon>
        <span>Voltar</span>
      </a>
      <a class="btn btn-primary" [routerLink]="['/tabela-produtividade/novo']">
        <hero-icon name="plus" size="1.25rem"></hero-icon>
        <span>Novo Registro</span>
      </a>
    </div>
  </div>

  <div class="card">
    <div class="card-body">
      <div class="table-toolbar">
        <div class="search-box">
          <hero-icon name="magnifying-glass" size="1.25rem" class="search-icon"></hero-icon>
          <input type="text" class="form-control" [(ngModel)]="filtro" name="filtro" placeholder="Buscar..." />
          <button class="btn-clear" type="button" (click)="clearFilter()" *ngIf="filtro">
            <hero-icon name="x-mark" size="1rem"></hero-icon>
          </button>
        </div>
      </div>

      <div *ngIf="loading" class="loading-state">
        <div class="spinner"></div>
        <span>Carregando...</span>
      </div>

      <ng-container *ngIf="!loading">
        <div class="table-responsive">
          <table class="table">
            <thead>
              <tr>
                <th class="col-codigo">
                  <button type="button" class="sort-btn" (click)="setSort('codigo')">
                    <span [class.active]="sortKey==='codigo'">Código</span>
                    <hero-icon
                      [name]="sortKey==='codigo' ? (sortDir==='asc' ? 'arrow-up' : 'arrow-down') : 'arrows-up-down'"
                      size="1rem"></hero-icon>
                  </button>
                </th>
                <th>
                  <button type="button" class="sort-btn" (click)="setSort('nome')">
                    <span [class.active]="sortKey==='nome'">Nome</span>
                    <hero-icon
                      [name]="sortKey==='nome' ? (sortDir==='asc' ? 'arrow-up' : 'arrow-down') : 'arrows-up-down'"
                      size="1rem"></hero-icon>
                  </button>
                </th>
                <th class="col-acoes text-end">Ações</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let item of pageItems">
                <td><span class="badge-codigo">{{ item.codigo }}</span></td>
                <td>{{ item.nome }}</td>
                <td class="text-end">
                  <div class="action-buttons">
                    <a class="btn btn-icon btn-ghost" [routerLink]="['/tabela-produtividade', item.codigo, 'editar']"
                      title="Editar">
                      <hero-icon name="pencil" size="1.125rem"></hero-icon>
                    </a>
                    <button type="button" class="btn btn-icon btn-ghost-danger" (click)="openDelete(item.codigo)"
                      title="Excluir">
                      <hero-icon name="trash" size="1.125rem"></hero-icon>
                    </button>
                  </div>
                </td>
              </tr>
              <tr *ngIf="filtrados.length === 0">
                <td colspan="3" class="empty-state">
                  <hero-icon name="document" size="3rem" class="empty-icon"></hero-icon>
                  <p>Nenhum registro encontrado</p>
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <div class="table-footer" *ngIf="filtrados.length > 0">
          <div class="table-info">Mostrando {{ startIndex }}–{{ endIndex }} de {{ total }}</div>
          <div class="table-pagination">
            <div class="page-size-select">
              <span>Por página:</span>
              <select class="form-select form-select-sm" [(ngModel)]="pageSize" name="pageSize"
                (ngModelChange)="goTo(1)">
                <option *ngFor="let s of pageSizes" [value]="s">{{ s }}</option>
              </select>
            </div>
            <div class="pagination-buttons">
              <button class="btn btn-icon btn-ghost" (click)="goTo(page - 1)" [disabled]="page === 1">
                <hero-icon name="chevron-left" size="1.25rem"></hero-icon>
              </button>
              <span class="page-indicator">{{ page }} / {{ totalPages }}</span>
              <button class="btn btn-icon btn-ghost" (click)="goTo(page + 1)" [disabled]="page === totalPages">
                <hero-icon name="chevron-right" size="1.25rem"></hero-icon>
              </button>
            </div>
          </div>
        </div>
      </ng-container>
    </div>
  </div>

  <div class="modal-overlay" *ngIf="showDeleteModal" (click)="closeDelete()">
    <div class="modal-container" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <div class="modal-icon modal-icon-danger">
          <hero-icon name="exclamation-triangle" size="1.5rem"></hero-icon>
        </div>
        <h3>Confirmar exclusão</h3>
        <button type="button" class="btn btn-icon btn-ghost modal-close" (click)="closeDelete()" [disabled]="deleting">
          <hero-icon name="x-mark" size="1.25rem"></hero-icon>
        </button>
      </div>
      <div class="modal-body">
        <p>Tem certeza que deseja excluir o registro de código <strong>{{ toDelete }}</strong>?</p>
        <p class="text-muted">Esta ação não pode ser desfeita.</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="closeDelete()" [disabled]="deleting">Cancelar</button>
        <button type="button" class="btn btn-danger" (click)="confirmDelete()" [disabled]="deleting">
          <span *ngIf="!deleting">Excluir</span>
          <span *ngIf="deleting" class="btn-loading"><span class="spinner-sm"></span>Excluindo...</span>
        </button>
      </div>
    </div>
  </div>
</div>